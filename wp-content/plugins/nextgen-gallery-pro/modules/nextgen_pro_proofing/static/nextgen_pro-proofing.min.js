!function(i){var n={initialize:function(){this.bind_events()},formatString:function(){var i=arguments;return this.replace(/{(\d+)}/g,(function(n,e){return void 0!==i[e]?i[e]:n}))},setTriggerProof:function(i,n){var e=i.data("class-on"),o=i.data("class-off");i.data("proofed",n?"1":"0"),n?(i.removeClass(o),i.addClass(e),i.addClass("ngg-proofing-on")):(i.removeClass(e),i.addClass(o),i.removeClass("ngg-proofing-on"))},removeAllProofs:function(n){var e=this;e.getList(n).length<=0||(i(".ngg-trigger-proofing").each((function(i,o){var g=jQuery(o);g.data("image-id");if(g.data("nplmodal-gallery-id")!=n)return!0;e.setTriggerProof(g,!1)})),Ngg_Store.set("ngg_proofing_"+n,""))},setActiveTriggers:function(n){var e=this,o=e.getList(n);o.length<=0||i(".ngg-trigger-proofing").each((function(i,g){var a=jQuery(g),r=a.data("image-id");if(a.data("nplmodal-gallery-id")!=n)return!0;o.indexOf(r.toString())>-1&&e.setTriggerProof(a,!0)}))},getDialog:function(n){var e=this,o=jQuery("#ngg-proofing-dialog-"+n);if(0==o.length){var g=e.getList(n),a=e.formatString.call(ngg_pro_proofing_i18n.image_list,g.length,1!=g.length?"s":""),r="";g.length<=0&&(r=' disabled="disabled" ');var t='<div id="ngg-proofing-dialog-'+n+'" class="ngg-proofing-dialog" style="display:none;">';t+='<a href="javascript:void(0)" class="ngg-proofing-cancel">',t+='<span class="fa-stack"><i class="fa fa-circle fa-stack-2x"></i><i class="fa fa-times fa-stack-1x"></i></span>',t+="</a>",t+='<h3 class="ngg-proofing-label">'+a+"</h3>",t+='<div class="ngg-proofing-form">',t+='<div class="ngg-proofing-form-entry">',t+='<input type="hidden" class="ngg-proofing-list" name="list" value=""/>',t+='<div class="ngg-proofing-fullname-wrapper">',t+='<span><i class="fa fa-fw fa-user"></i></span>',t+='<input type="text" required class="ngg-proofing-fullname" name="customer_name" placeholder="'+ngg_pro_proofing_i18n.example_name+'"/>',t+="</div>",t+='<div class="ngg-proofing-email-wrapper">',t+='<span><i class="fa fa-fw fa-envelope"></i></span>',t+='<input type="email" required class="ngg-proofing-email" name="email" placeholder="'+ngg_pro_proofing_i18n.example_email+'"/>',t+="</div>",t+="</div>",t+='<div class="ngg-proofing-form-entry ngg-form-entry-submit">',t+='<button class="button button-primary ngg-proofing-submit" type="submit" name="submit"'+r+">"+ngg_pro_proofing_i18n.submit_button+'&nbsp;<i class="fa fa-arrow-circle-right"></i></button>',t+="</div>",(o=i(t+="</div></div>")).find(".ngg-proofing-cancel").on("click",(function(n){n.preventDefault(),i("html, body").removeClass("ngg_proofing_form_open"),o.hide(),i("#ngg_proofing_overlay").hide()})),o.find(".ngg-proofing-submit").on("click",(function(g){g.preventDefault();var a=o.find(".ngg-proofing-email")[0],r=o.find(".ngg-proofing-fullname")[0],t=e.getList(n),l=o.find(".ngg-proofing-submit");l.html(ngg_pro_proofing_i18n.submit_message),l.attr("disabled","disabled"),i.post(photocrati_ajax.url,{action:"submit_proofed_gallery",email:a.value,customer_name:r.value,proofed_gallery:{image_list:t}},(function(g){"string"==typeof g&&(g=JSON.parse(g)),g.error?alert(g.error):g.status&&"done"===g.status&&(e.removeAllProofs(n),o.hide(),i("#ngg_proofing_overlay").hide(),g.redirect&&(window.location=g.redirect)),l.html(ngg_pro_proofing_i18n.submit_button),l.removeAttr("disabled")}))})),o.appendTo(document.body)}return o},getList:function(i){var n=[],e=Ngg_Store.get("ngg_proofing_"+i);return e&&(n=e.split(",")),n},updateAllGalleries:function(){var n=this;i.each(galleries,(function(i,e){n.setActiveTriggers(e.ID)}))},setDialogStrings:function(i,n){i.find(".ngg-proofing-list").val(n.join(",")),i.find(".ngg-proofing-label").html(this.formatString.call(ngg_pro_proofing_i18n.image_list,n.length,1!=n.length?"s":"")),n.length>0?i.find(".ngg-proofing-submit").prop("disabled",!1):i.find(".ngg-proofing-submit").prop("disabled",!0)},addOrRemoveImage:function(n,e){var o=this,g=o.getDialog(n),a=o.getList(n),r=a.indexOf(e.toString());return r>-1?(a.splice(r,1),i(".ngg-trigger-proofing").each((function(i,g){var a=jQuery(g);if(a.data("nplmodal-gallery-id")!=n)return!0;a.data("image-id")==e&&o.setTriggerProof(a,!1)}))):a.push(e.toString()),Ngg_Store.set("ngg_proofing_"+n,a.join(",")),o.setActiveTriggers(n),o.setDialogStrings(g,a),a},bind_events:function(){var n=this;i((function(){i("body").append('<div id="ngg_proofing_overlay" style="display: none;"></div>'),n.updateAllGalleries()})),i(document).on("DOMContentLoaded",(function(){setTimeout((function(){n.updateAllGalleries()}),250)})),i(document).on("ngg-captions-added",(function(){n.updateAllGalleries()})),i(document).on("ngg-caption-add-icons",(function(e,o){if(i.nplModal("get_displayed_gallery_setting",o.gallery_id,"ngg_proofing_display",!1)){var g=i("<i/>",{class:"fa fa-star ngg-trigger-proofing ngg-caption-icon","data-nplmodal-gallery-id":o.gallery_id,"data-nplmodal-image-id":o.image_id,"data-image-id":o.image_id}).on("click",(function(i){return i.preventDefault(),n.addOrRemoveImage(o.gallery_id,o.image_id),!1}));o.el.append(g)}})),i(document).on("refreshed",(function(i){n.updateAllGalleries()})),i(document).on("click",".ngg-pro-proofing-trigger-link",(function(e){e.preventDefault();var o=n.getDialog(i(this).data("gallery-id"));i("#ngg_proofing_overlay").show(),i("html, body").addClass("ngg_proofing_form_open"),o.show()})),i(document).on("click",".ngg-trigger-proofing",(function(i){var e=jQuery(this),o=e.data("nplmodal-gallery-id"),g=e.data("image-id");n.addOrRemoveImage(o,g)}))}};n.initialize(),window.ngg_image_proofing=n}(jQuery);