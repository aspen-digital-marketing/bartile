function photocrati_autoupdate_string_format(){var t=arguments;try{return this.replace(/{(\d+)}/g,(function(a,e){return void 0!==t[e]?t[e]:a}))}catch(t){return this}}function photocrati_autoupdate_readable_size(t){if(0==t)return"number"==typeof t?"0 bytes":"n/a";var a=parseInt(Math.floor(Math.log(t)/Math.log(1024)));return Math.ceil(t/Math.pow(1024,a),2)+" "+["Bytes","KiB","MiB","GiB","TiB"][a]}function photocrati_autoupdate_expand_json(t){var a=null;try{a=JSON.parse(t)}catch(e){a=JSON.parse(jQuery("<div/>").html(t).text())}return a}String.prototype.format=function(){return photocrati_autoupdate_string_format.apply(this,arguments)};var Photocrati_AutoUpdate_Admin={performRequest:function(t,a){null!=a&&null!=a||(a={})},updateStart:function(t,a){var e=t.find(".details .message"),n=t.find(".details .log"),i=t.find(".progress-bar");e.html(a.updater_status_preparing),t.data("update-index",0),t.data("update-stage","download"),n.html(""),i.progressbar("option","value",1),i.show(),this.updateContinue(t,a)},updateContinue:function(t,a){var e=t.find(".details .message"),n=t.find(".details .log"),i=t.find(".progress-bar"),d=t.data("update-list"),o=t.data("update-index")||0,r=t.data("update-stage");if(o>=d.length){switch(r){case"download":t.data("update-stage","install");break;case"install":t.data("update-stage","activate");break;case"activate":t.data("update-stage","cleanup")}var s=t.data("update-stage");if(r==s)return e.html('<span style="color:#44aa44;font-weight:bold;">'+a.updater_status_done+"</span>"),t.find(".details .button-update-start").hide(),t.find(".details .button-update-done").css("display","inline"),n.append("Update Completed.\n"),void i.progressbar("option","value",100);n.append('Completed queue for stage "{0}", next queue stage is "{1}".\n'.format(r,s)),t.data("update-index",0),o=t.data("update-index")||0,r=s}var p=d[o],u=p.info,l=u["-command-stage"]||"download";if("updater_status_stage_"+r in a&&e.html(a["updater_status_stage_"+r].format(d.length,o+1)),l==r){var c=t.data("form-submit-data")||{},f='Performing stage "{1}" request for "{0}"...';c.action="photocrati_autoupdate_admin_handle",c.actionSec=Photocrati_AutoUpdate_Admin_Settings.actionSec,"activate"==r?(n.append(f.format("&lt;All&gt;",r)),c["update-action"]="handle-list",c["update-list"]=d):(n.append(f.format(u["module-id"],l)),c["update-action"]="handle-item",c["update-item"]=p),jQuery.ajax({type:"POST",url:Photocrati_AutoUpdate_Admin_Settings.ajaxurl,data:c,success:function(t,a){return function(e,i,d){if("string"==typeof e)n.append('Possibly Failed...wrong output generated ["{0}"].\n'.format(e));else if(n.append("Success.\n"),"action"in e)t[a]=e;else if(e.length>0&&"action"in e[0]){t.splice(0,t.length);for(var o=0;o<e.length;o++)t.push(e[o])}}}(d,o),error:function(t,a,e){n.append('Failed ["{0}"].\n'.format(e))},complete:function(d,o){return function(r,s){t.data("update-stage");!function(d,o){var r=t.data("update-stage"),s=d[o].info,p=null,u=!0;if(s["-command-error"]&&(p=s["-command-error"],n.append('An error occurred ["{2}"] at stage "{0}" for "{1}" {3}.\n'.format(r,s["module-id"],p,s["module-version"])),s["-command-form"])){u=!1,n.append("Displaying FTP credentials form...");var l=jQuery("<div>"+s["-command-form"]+"</div>").find("form"),c=t.data("form-submit-data");if(c)for(var f in c)l.find("[name="+f+"]").val(c[f]);l.data("submit-ok",!1),l.submit((function(){return l.data("submit-ok",!0),l.dialog("close"),!1})),l.find(".wrap .icon32").attr("id","icon-index"),l.dialog({title:"Connection Details",width:550,modal:!0,resizable:!1,close:function(){if(1==l.data("submit-ok")){n.append("Done.\n");var d=l.serializeArray(),o={};for(var r in d)o[d[r].name]=d[r].value;t.data("form-submit-data",o),Photocrati_AutoUpdate_Admin.updateContinue(t,a)}else n.append("Canceled.\n"),e.html(a.updater_status_cancel),i.progressbar("option","value",0)}})}if(u){var m=i.progressbar("option","value"),_=99*{download:.6,install:.3,activate:.05,cleanup:.05}[r]/d.length,g=p?"Skipped":"Completed",h="download"==r&&!p?', stored into "{0}"'.format(s["-command-package-file"]):"";i.progressbar("option","value",m+_),n.append('{0} stage "{3}" for ({2}) "{1}"{5}. Next stage is "{4}".\n'.format(g,s["module-id"],o,r,s["-command-stage"],h)),t.data("update-index",o+1),Photocrati_AutoUpdate_Admin.updateContinue(t,a)}}(d,o)}}(d,o)})}else n.append('Skipping ({1}) "{0}" in stage "{2}" while performing stage "{3}"...\n'.format(u["module-id"],o,l,r)),t.data("update-index",o+1),this.updateContinue(t,a)}};jQuery(document).ready((function(){var t=jQuery("#update-content"),a=jQuery("#update-loader");if(0!=t.length){var e=jQuery("<div />"),n=photocrati_autoupdate_expand_json(Photocrati_AutoUpdate_Admin_Settings.update_list),i=photocrati_autoupdate_expand_json(Photocrati_AutoUpdate_Admin_Settings.text_list),d=null;if(n.length>0){for(var o=0,r=0,s=0,p=null,u=null,l=0,c=0,f=0;f<n.length;f++){var m=n[f].info;if("product-invalid-license"in m){if(r++,"product-invalid-license-link"in m){var _=m["product-invalid-license-link"];null==p&&(p=_)}}else if("product-expired"in m){if(s++,"product-expired-link"in m){_=m["product-expired-link"];null==u&&(u=_)}}else c+=m["module-package-size"];l+=m["module-package-size"],o++}if(o>0){var g=o-(r+s);if(l=photocrati_autoupdate_readable_size(l),c=photocrati_autoupdate_readable_size(c),e.append('<div class="details"><span class="update-info">'+i.updates_available.format(o,g)+"</span></div>"),r>0&&(p+=-1==p.indexOf("?")?"?":"&",p+="pclst="+escape(Photocrati_AutoUpdate_Admin_Settings.request_site),e.append('<div class="details details-alert"><span class="message">'+i.updates_license_invalid.format(r,o,"")+'</span> &nbsp; <a href="'+p+'" class="button-secondary" target="_blank">'+i.updates_license_get+"</a></div>")),s>0&&(u+=-1==u.indexOf("?")?"?":"&",u+="pclst="+escape(Photocrati_AutoUpdate_Admin_Settings.request_site),e.append('<div class="details details-alert"><span class="message">'+i.updates_expired.format(s,o,"")+'</span> &nbsp; <a href="'+u+'" class="button-secondary" target="_blank">'+i.updates_renew+"</a></div>")),g>0){d=jQuery('<div class="updater" id="update-updater" />');var h,v=jQuery('<span class="message"></span>'),b=jQuery('<pre class="log"></pre>'),y=jQuery('<div class="progress-bar" />').progressbar();d.data("update-list",n),v.html(i.updater_status_start);var j=null;(j=jQuery('<div class="details"></div>')).append(v),d.append(j),j=jQuery('<div class="details"></div>');var A=jQuery('<button class="button-secondary download-log" style="visibility:hidden">'+i.updater_logger_download+"</button>"),Q=jQuery('<span class="show-log-button">'+i.updater_logger_title+"</span>").css({cursor:"pointer"}).hide().on("click",(function(t){return t.preventDefault(),jQuery(this).parent().find(".log").slideToggle(),!1}));j.append(jQuery('<h4 class="show-log"></h4>').append(Q).append(A)),j.css({overflow:"auto"}),b.css({height:300}).hide(),j.append(b),h=j,A.on("click",(function(t){t.preventDefault();var a=d.data("form-submit-data")||{};a.action="photocrati_autoupdate_admin_handle",a.actionSec=Photocrati_AutoUpdate_Admin_Settings.actionSec,a["update-action"]="download-log",a["update-log"]=b.text();var n=jQuery("<form />");for(var i in n.attr("method","POST"),n.attr("action",Photocrati_AutoUpdate_Admin_Settings.ajaxurl),n.attr("target","_blank"),n.width(1).height(1),a){var o=jQuery('<input type="hidden" />');o.attr("name",i).val(a[i]),n.append(o)}return e.append(n),n.submit(),!1})),y.hide(),y.bind("progressbarchange",(function(t,a){var e=jQuery(this).progressbar("option","value");0!=e&&100!=e||A.css("visibility","visible")})),(j=jQuery('<div class="details"></div>')).append(y),d.append(j),(j=jQuery('<div class="details"></div>')).append(jQuery('<button class="button-primary button-update-start">'+i.updater_button_start+"</button>").on("click",(function(t){t.preventDefault();var a=jQuery(this);return a.prop("disabled")||(a.attr("disabled","disabled"),Photocrati_AutoUpdate_Admin.updateStart(d,i)),!1}))),j.append(jQuery('<a class="button-primary button-update-done" href="'+Photocrati_AutoUpdate_Admin_Settings.adminurl+'">'+i.updater_button_done+"</a>").hide()),d.append(j),d.append(h),e.append(d)}}}else e.append('<span class="message">'+i.no_updates+"</span>");a.remove(),t.append(e)}}));